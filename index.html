const videoElement = document.getElementById('input_video');
    const statusBox = document.getElementById('status-indicator');
    const logBox = document.getElementById('log-box');
    const alarm = document.getElementById('alarm');
    
    let signalCount = 0;
    let isCurrentlySignaling = false;

    function onResults(results) {
      if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        const hand = results.multiHandLandmarks[0];
        
        // Tracking: Thumb tip (4) vs Pinky base (17) and Finger tips (8, 12, 16)
        const thumbTucked = hand[4].x > hand[13].x; // Thumb pulled toward palm
        const fingersFolded = hand[8].y > hand[6].y && hand[12].y > hand[10].y; // Fingers down

        if (thumbTucked && fingersFolded) {
          if (!isCurrentlySignaling) {
            isCurrentlySignaling = true;
            signalCount++;
            handleDetection();
          }
        } else {
          if (isCurrentlySignaling) {
            isCurrentlySignaling = false;
            resetUI();
          }
        }
      }
    }

    function handleDetection() {
      statusBox.style.background = "red";
      statusBox.innerText = "SIGNAL DETECTED";
      
      if (signalCount < 4) {
        logBox.innerHTML += `<br>> [LOG] Signal identified ${signalCount} time(s).`;
      } else if (signalCount === 4) {
        logBox.innerHTML += `<br>> [CRITICAL] 4th Signal identified! Starting Alarm...`;
        alarm.play();
        statusBox.classList.add('alarm-active');
      } else {
        logBox.innerHTML += `<br>> [ALARM] Continuing detection #${signalCount}`;
      }
      
      logBox.scrollTop = logBox.scrollHeight;
    }

    function resetUI() {
      statusBox.style.background = "green";
      statusBox.innerText = "SAFE / SCANNING";
      logBox.innerHTML += `<br>> System reset. Waiting for next signal...`;
      logBox.scrollTop = logBox.scrollHeight;
    }

    // Initialize MediaPipe
    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
    hands.onResults(onResults);

    const camera = new Camera(videoElement, {
      onFrame: async () => { await hands.send({image: videoElement}); },
      width: 480, height: 360
    });
    camera.start();
